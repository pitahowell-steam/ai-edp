<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Engineer Lab: Confidence Mode</title>
    <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f9; color: #333; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 950px; width: 100%; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px; }
        .zone { background: #ffffff; border: 2px solid #e0e6ed; padding: 20px; border-radius: 15px; position: relative; }
        .status-header { background: #2c3e50; color: white; padding: 15px; border-radius: 10px; width: 100%; text-align: center; margin-bottom: 20px; font-weight: bold; }
        img { width: 100%; height: 220px; object-fit: contain; background: #f8f9fa; border-radius: 10px; border: 1px solid #dee2e6; margin: 10px 0; }
        input { width: 100%; padding: 12px; border: 2px solid #cbd5e0; border-radius: 8px; margin-bottom: 10px; }
        button { width: 100%; padding: 14px; margin: 5px 0; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: transform 0.1s; }
        button:active { transform: scale(0.98); }
        .btn-apple { background: #27ae60; color: white; }
        .btn-tomato { background: #e74c3c; color: white; }
        .btn-train { background: #3498db; color: white; font-size: 1.1em; }
        .btn-train:disabled { background: #bdc3c7; cursor: not-allowed; }
        
        /* Confidence Bar Styling */
        .confidence-container { margin-top: 20px; display:none; }
        .bar-bg { background: #edf2f7; border-radius: 10px; height: 25px; width: 100%; overflow: hidden; border: 1px solid #cbd5e0; }
        #bar-fill { background: #3498db; height: 100%; width: 0%; transition: width 0.5s ease-out; }
        #result-text { font-size: 1.5em; font-weight: bold; margin-bottom: 5px; text-align: center; }
        .edp-hint { font-size: 0.9em; color: #718096; font-style: italic; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div id="status" class="status-header">Initializing AI Engine...</div>
    
    <div class="grid">
        <div class="zone">
            <h3>Step 1: Create Data</h3>
            <input type="text" id="train-url" placeholder="Paste Image URL here...">
            <img id="train-preview" src="https://placehold.co/400x220?text=Paste+URL+to+Preview" crossorigin="anonymous">
            <button class="btn-apple" onclick="addSample('Apple')">Label as APPLE</button>
            <button class="btn-tomato" onclick="addSample('Tomato')">Label as TOMATO</button>
            <p style="text-align:center">Training Set: <b id="count">0</b> images</p>
            <button class="btn-train" id="train-btn" onclick="train()" disabled>Start Machine Learning</button>
        </div>

        <div class="zone">
            <h3>Step 2: Evaluate Model</h3>
            <input type="text" id="test-url" placeholder="Paste Test URL here...">
            <img id="test-preview" src="https://placehold.co/400x220?text=Test+Image+Preview" crossorigin="anonymous">
            <button onclick="predict()" style="background:#2c3e50; color:white;">Run Prediction</button>
            
            <div class="confidence-container" id="conf-box">
                <div id="result-text">---</div>
                <div class="bar-bg"><div id="bar-fill"></div></div>
                <p id="conf-label" style="text-align:right; font-size:0.8em; margin-top:5px;">Confidence: 0%</p>
                <div id="edp-advice" class="edp-hint"></div>
            </div>
        </div>
    </div>
</div>

<script>
    let featureExtractor;
    let classifier;
    let samples = 0;

    // Load MobileNet
    featureExtractor = ml5.featureExtractor('MobileNet', () => {
        document.getElementById('status').innerText = "âœ… AI Ready: Start Training Your Model";
        classifier = featureExtractor.classification();
    });

    // Auto-update previews
    document.getElementById('train-url').oninput = (e) => document.getElementById('train-preview').src = e.target.value;
    document.getElementById('test-url').oninput = (e) => document.getElementById('test-preview').src = e.target.value;

    function addSample(label) {
        classifier.addImage(document.getElementById('train-preview'), label);
        samples++;
        document.getElementById('count').innerText = samples;
        if(samples >= 4) document.getElementById('train-btn').disabled = false;
    }

    function train() {
        document.getElementById('status').innerText = "ðŸ§  Learning Patterns... Please Wait.";
        classifier.train((loss) => {
            if(!loss) document.getElementById('status').innerText = "âœ… Training Finished! Move to Step 2.";
        });
    }

    function predict() {
        classifier.classify(document.getElementById('test-preview'), (err, results) => {
            if(err) return alert("CORS Error: Try a Wikipedia link!");
            
            const confBox = document.getElementById('conf-box');
            const resText = document.getElementById('result-text');
            const bar = document.getElementById('bar-fill');
            const advice = document.getElementById('edp-advice');
            
            confBox.style.display = "block";
            let label = results[0].label;
            let confidence = results[0].confidence;
            let percent = Math.round(confidence * 100);

            resText.innerText = "Prediction: " + label;
            bar.style.width = percent + "%";
            document.getElementById('conf-label').innerText = "Confidence: " + percent + "%";

            // EDP Feedback Logic
            if(percent < 70) {
                advice.innerText = "EDP Note: Low confidence! You need more diverse training images.";
                bar.style.background = "#f1c40f";
            } else {
                advice.innerText = "EDP Note: Strong pattern found! Does it pass the 'Trick' test?";
                bar.style.background = "#27ae60";
            }
        });
    }
</script>
</body>
</html>

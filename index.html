<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Lab: Fix Version</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ml5/0.12.2/ml5.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 600px; width: 100%; }
        .status { background: #fff3cd; padding: 10px; margin-bottom: 20px; border-radius: 5px; font-weight: bold; text-align: center; }
        img { width: 100%; height: 200px; object-fit: contain; background: #ddd; margin: 10px 0; }
        button { padding: 10px; margin: 5px; cursor: pointer; width: 45%; font-weight: bold; }
        #train-btn { width: 100%; background: #2196f3; color: white; border: none; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div id="status" class="status">Step 1: Loading AI Brain...</div>
    
    <input type="text" id="url-input" placeholder="Paste Image URL..." style="width: 95%; padding: 8px;">
    <img id="preview" crossorigin="anonymous" src="https://placehold.co/400x200?text=Waiting+for+URL">
    
    <div style="text-align: center;">
        <button onclick="addSample('Apple')" style="background:#d4edda">Label Apple</button>
        <button onclick="addSample('Tomato')" style="background:#f8d7da">Label Tomato</button>
    </div>
    
    <p>Samples added: <b id="count">0</b></p>
    <button id="train-btn" onclick="startTraining()" disabled>Train Model</button>
    <button id="predict-btn" onclick="predict()" style="width:100%; margin-top:10px;" disabled>Check AI Guess</button>
    
    <h2 id="result" style="text-align: center;">---</h2>
</div>

<script>
    // Define variables globally
    let featureExtractor;
    let classifier;
    let count = 0;

    // Load the model
    console.log("Attempting to load ml5...");
    featureExtractor = ml5.featureExtractor('MobileNet', modelLoaded);

    function modelLoaded() {
        console.log("Model Loaded!");
        document.getElementById('status').innerText = "âœ… AI Brain Loaded!";
        document.getElementById('status').style.background = "#d4edda";
        classifier = featureExtractor.classification();
    }

    // Update image
    document.getElementById('url-input').oninput = function() {
        document.getElementById('preview').src = this.value;
    };

    // ADD SAMPLE FUNCTION
    function addSample(label) {
        if (!classifier) {
            alert("AI is still loading. Wait for the green status bar!");
            return;
        }
        const img = document.getElementById('preview');
        classifier.addImage(img, label, () => {
            count++;
            document.getElementById('count').innerText = count;
            if(count >= 3) document.getElementById('train-btn').disabled = false;
        });
    }

    // TRAINING FUNCTION
    function startTraining() {
        document.getElementById('status').innerText = "ðŸ§  Training... (Please wait)";
        classifier.train((loss) => {
            if (loss === null) {
                document.getElementById('status').innerText = "âœ… Training Ready!";
                document.getElementById('predict-btn').disabled = false;
            }
        });
    }

    // PREDICT FUNCTION
    function predict() {
        const img = document.getElementById('preview');
        classifier.classify(img, (err, res) => {
            if (res) {
                document.getElementById('result').innerText = res[0].label + " (" + Math.round(res[0].confidence * 100) + "%)";
            }
        });
    }
</script>
</body>
</html>
